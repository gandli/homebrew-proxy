# Cask æ–‡ä»¶æ ‡å‡†åŒ–æŒ‡å—

æœ¬æ–‡æ¡£å®šä¹‰äº†é¡¹ç›®ä¸­ Cask æ–‡ä»¶çš„æ ‡å‡†åŒ–è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

## ğŸ“‹ æ ‡å‡†åŒ–æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆçš„æ ‡å‡†åŒ–æ”¹è¿›

#### 1. Livecheck é…ç½®å®Œå–„

æ‰€æœ‰ Cask æ–‡ä»¶ç°å·²åŒ…å« `livecheck` é…ç½®ï¼Œç¡®ä¿è‡ªåŠ¨æ›´æ–°åŠŸèƒ½å®Œæ•´ï¼š

- âœ… **hiddify.rb** - æ·»åŠ äº† `github_latest` ç­–ç•¥
- âœ… **flclash.rb** - æ·»åŠ äº† `github_latest` ç­–ç•¥  
- âœ… **clash-nyanpasu.rb** - æ·»åŠ äº† `github_latest` ç­–ç•¥
- âœ… **sfm.rb** - æ·»åŠ äº† `github_latest` ç­–ç•¥
- âœ… **clashx-meta.rb** - å·²æœ‰é…ç½®
- âœ… **clash-verge-rev.rb** - å·²æœ‰é…ç½®
- âœ… **mihomo-party.rb** - å·²æœ‰é…ç½®
- âœ… **v2rayn.rb** - å·²æœ‰é…ç½®
- âœ… **v2rayu.rb** - å·²æœ‰é…ç½®
- âš ï¸ **qv2ray.rb** - å·²ç¦ç”¨ï¼Œæ— éœ€é…ç½®

#### 2. å¤šæ¶æ„æ”¯æŒä¼˜åŒ–

- âœ… **flclash.rb** - ä»å•ä¸€ arm64 æ”¯æŒæ‰©å±•ä¸ºå¤šæ¶æ„æ”¯æŒ

### ğŸ¯ æ¶æ„å‘½åè§„èŒƒåˆ†æ

ç»è¿‡è¯¦ç»†åˆ†æï¼Œå‘ç°ä¸åŒé¡¹ç›®åœ¨ GitHub Releases ä¸­ä½¿ç”¨ä¸åŒçš„æ¶æ„å‘½åçº¦å®šï¼š

| Cask æ–‡ä»¶ | æ¶æ„å‘½å | åŸå›  |
|-----------|----------|------|
| **clash-nyanpasu.rb** | `aarch64` / `x64` | éµå¾ªä¸Šæ¸¸é¡¹ç›®çš„å‘å¸ƒå‘½å |
| **clash-verge-rev.rb** | `aarch64` / `x64` | éµå¾ªä¸Šæ¸¸é¡¹ç›®çš„å‘å¸ƒå‘½å |
| **flclash.rb** | `arm64` / `intel` | æ ‡å‡†åŒ–å‘½åï¼ˆæ–°å¢å¤šæ¶æ„æ”¯æŒï¼‰ |
| **mihomo-party.rb** | `arm64` / `x64` | éµå¾ªä¸Šæ¸¸é¡¹ç›®çš„å‘å¸ƒå‘½å |
| **v2rayn.rb** | `arm64` / `64` | éµå¾ªä¸Šæ¸¸é¡¹ç›®çš„å‘å¸ƒå‘½å |
| **v2rayu.rb** | `arm64` / `64` | éµå¾ªä¸Šæ¸¸é¡¹ç›®çš„å‘å¸ƒå‘½å |

**é‡è¦åŸåˆ™**: æ¶æ„å‘½åå¿…é¡»ä¸ä¸Šæ¸¸é¡¹ç›®çš„å®é™…å‘å¸ƒæ–‡ä»¶åä¿æŒä¸€è‡´ï¼Œä¸èƒ½ä¸ºäº†ç»Ÿä¸€è€Œç ´ååŠŸèƒ½ã€‚

## ğŸ“ Cask æ–‡ä»¶æ ‡å‡†æ¨¡æ¿

### åŸºç¡€æ¨¡æ¿

```ruby
cask "app-name" do
  # å¤šæ¶æ„æ”¯æŒï¼ˆå¦‚æœé€‚ç”¨ï¼‰
  arch arm: "arm64", intel: "intel"  # æ ¹æ®ä¸Šæ¸¸é¡¹ç›®è°ƒæ•´

  version "x.y.z"
  sha256 arm:   "sha256_for_arm",     # å¤šæ¶æ„æ—¶ä½¿ç”¨
         intel: "sha256_for_intel"   # å¤šæ¶æ„æ—¶ä½¿ç”¨
  # æˆ–å•æ¶æ„æ—¶ï¼š
  # sha256 "single_sha256"

  url "https://github.com/owner/repo/releases/download/v#{version}/app-#{version}-#{arch}.dmg"
  name "App Name"
  desc "App description"
  homepage "https://app-homepage.com/"

  # å¿…éœ€ï¼šlivecheck é…ç½®
  livecheck do
    url :url
    strategy :github_latest
  end

  # å¯é€‰ï¼šè‡ªåŠ¨æ›´æ–°
  auto_updates true

  # å¯é€‰ï¼šç³»ç»Ÿè¦æ±‚
  depends_on macos: ">= :catalina"

  app "App.app"
  # æˆ– pkg å®‰è£…ï¼š
  # pkg "app-installer.pkg"

  # å¯é€‰ï¼šå¸è½½é…ç½®
  uninstall quit: "com.app.bundle.id"

  # æ¨èï¼šæ¸…ç†é…ç½®
  zap trash: [
    "~/Library/Application Support/app",
    "~/Library/Preferences/com.app.bundle.id.plist",
  ]
end
```

### ç‰¹æ®Šæƒ…å†µå¤„ç†

#### 1. æ¡ä»¶å®‰è£…ï¼ˆå¦‚ mihomo-party.rbï¼‰

```ruby
on_catalina :or_older do
  # Catalina åŠæ›´æ—©ç‰ˆæœ¬çš„é…ç½®
end
on_big_sur :or_newer do
  # Big Sur åŠæ›´æ–°ç‰ˆæœ¬çš„é…ç½®
end
```

#### 2. å·²ç¦ç”¨çš„åº”ç”¨

```ruby
disable! date: "YYYY-MM-DD", because: :discontinued
no_autobump! because: :requires_manual_review
```

#### 3. éœ€è¦ç‰¹æ®Šå¤„ç†çš„åº”ç”¨

```ruby
preflight do
  system_command "xattr", args: ["-cr", "#{staged_path}/App.app"]
end
```

## ğŸ” è´¨é‡æ£€æŸ¥æ ‡å‡†

### å¿…éœ€é¡¹ç›®

- [ ] **version** - ç‰ˆæœ¬å·
- [ ] **sha256** - æ–‡ä»¶æ ¡éªŒå’Œ
- [ ] **url** - ä¸‹è½½é“¾æ¥
- [ ] **name** - åº”ç”¨åç§°
- [ ] **desc** - åº”ç”¨æè¿°
- [ ] **homepage** - ä¸»é¡µé“¾æ¥
- [ ] **livecheck** - è‡ªåŠ¨æ›´æ–°æ£€æŸ¥é…ç½®
- [ ] **app/pkg** - å®‰è£…ç›®æ ‡

### æ¨èé¡¹ç›®

- [ ] **auto_updates** - è‡ªåŠ¨æ›´æ–°æ”¯æŒ
- [ ] **depends_on** - ç³»ç»Ÿè¦æ±‚
- [ ] **zap** - æ¸…ç†é…ç½®
- [ ] **å¤šæ¶æ„æ”¯æŒ** - å¦‚æœä¸Šæ¸¸æä¾›

### ä»£ç è´¨é‡

- [ ] **ç¼©è¿›ä¸€è‡´** - ä½¿ç”¨ 2 ä¸ªç©ºæ ¼
- [ ] **å¼•å·ç»Ÿä¸€** - ä½¿ç”¨åŒå¼•å·
- [ ] **æ’åºè§„èŒƒ** - æŒ‰æ ‡å‡†é¡ºåºæ’åˆ—é…ç½®é¡¹
- [ ] **æ³¨é‡Šæ¸…æ™°** - ç‰¹æ®Šé…ç½®éœ€è¦æ³¨é‡Šè¯´æ˜

## ğŸš€ è‡ªåŠ¨åŒ–æ£€æŸ¥

### GitHub Actions é›†æˆ

é¡¹ç›®å·²é›†æˆä»¥ä¸‹è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼š

1. **è¯­æ³•æ£€æŸ¥** - `brew audit --cask`
2. **å®‰è£…æµ‹è¯•** - å®é™…å®‰è£…éªŒè¯
3. **è‡ªåŠ¨æ›´æ–°** - å®šæœŸæ£€æŸ¥æ–°ç‰ˆæœ¬
4. **é”™è¯¯å¤„ç†** - è·³è¿‡å·²ç¦ç”¨çš„åº”ç”¨
5. **æ¯å‘¨ä¸€è‡ªåŠ¨è¿è¡Œå®Œæ•´éªŒè¯**

### éªŒè¯è„šæœ¬

```bash
# éªŒè¯æ‰€æœ‰ Cask æ–‡ä»¶
./.github/scripts/validate-casks.sh

# éªŒè¯å•ä¸ª Cask æ–‡ä»¶
./.github/scripts/validate-casks.sh Casks/example.rb
```

### è‡ªåŠ¨ä¿®å¤è„šæœ¬

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./.github/scripts/fix-casks.sh --help

# é¢„è§ˆæ‰€æœ‰ä¿®å¤æ“ä½œï¼ˆä¸å®é™…ä¿®æ”¹ï¼‰
./.github/scripts/fix-casks.sh --dry-run --all

# ä¿®å¤æ‰€æœ‰ Cask æ–‡ä»¶
./.github/scripts/fix-casks.sh --all

# ä¿®å¤ç‰¹å®šæ–‡ä»¶
./.github/scripts/fix-casks.sh Casks/example.rb

# ä¿®å¤å¹¶æ·»åŠ  zap é…ç½®æ¨¡æ¿
./.github/scripts/fix-casks.sh --add-zap --all
```

### æœ¬åœ°éªŒè¯å‘½ä»¤

```bash
# è¯­æ³•æ£€æŸ¥
brew audit --cask gandli/proxy/app-name

# å®‰è£…æµ‹è¯•
brew install --cask gandli/proxy/app-name

# æ ·å¼æ£€æŸ¥
brew style Casks/app-name.rb

# Livecheck æµ‹è¯•
brew livecheck --cask gandli/proxy/app-name
```

## ğŸ“Š å½“å‰çŠ¶æ€æ€»ç»“

### ç»Ÿè®¡ä¿¡æ¯

- **æ€» Cask æ•°é‡**: 10
- **å·²é…ç½® livecheck**: 9 (90%)
- **å¤šæ¶æ„æ”¯æŒ**: 6 (60%)
- **å·²ç¦ç”¨åº”ç”¨**: 1 (qv2ray)
- **æ´»è·ƒç»´æŠ¤**: 9 (90%)

### æ¶æ„æ”¯æŒåˆ†å¸ƒ

| æ¶æ„æ”¯æŒç±»å‹ | æ•°é‡ | æ–‡ä»¶ |
|-------------|------|------|
| **å¤šæ¶æ„** | 6 | clash-nyanpasu, clash-verge-rev, flclash, mihomo-party, v2rayn, v2rayu |
| **Universal** | 1 | sfm |
| **å•æ¶æ„** | 2 | hiddify, clashx-meta |
| **å·²ç¦ç”¨** | 1 | qv2ray |

## ğŸ”„ ç»´æŠ¤æµç¨‹

### æ·»åŠ æ–° Cask

1. ä½¿ç”¨æ ‡å‡†æ¨¡æ¿åˆ›å»ºæ–‡ä»¶
2. ç¡®ä¿åŒ…å« livecheck é…ç½®
3. æµ‹è¯•å¤šæ¶æ„æ”¯æŒï¼ˆå¦‚æœé€‚ç”¨ï¼‰
4. è¿è¡Œæœ¬åœ°éªŒè¯å‘½ä»¤
5. æäº¤ PR è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

### æ›´æ–°ç°æœ‰ Cask

1. æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ ç¼ºå¤±çš„æ ‡å‡†é…ç½®
2. éªŒè¯ livecheck é…ç½®æ­£ç¡®æ€§
3. æµ‹è¯•æ¶æ„æ”¯æŒ
4. æ›´æ–°ç‰ˆæœ¬å’Œ SHA256
5. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

### å®šæœŸç»´æŠ¤

- **æ¯å‘¨**: æ£€æŸ¥è‡ªåŠ¨æ›´æ–°çŠ¶æ€
- **æ¯æœˆ**: å®¡æŸ¥å·²ç¦ç”¨åº”ç”¨çŠ¶æ€
- **æ¯å­£åº¦**: æ›´æ–°æ ‡å‡†åŒ–æŒ‡å—
- **æ¯å¹´**: å…¨é¢å®¡æŸ¥æ‰€æœ‰ Cask æ–‡ä»¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æäº¤ PR æ—¶è¯·ç¡®ä¿

1. éµå¾ªæœ¬æ–‡æ¡£çš„æ ‡å‡†åŒ–è§„èŒƒ
2. åŒ…å«å®Œæ•´çš„æµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. é€šè¿‡æ‰€æœ‰è‡ªåŠ¨åŒ–æ£€æŸ¥

### ä»£ç å®¡æŸ¥é‡ç‚¹

1. **åŠŸèƒ½æ­£ç¡®æ€§** - èƒ½å¦æ­£å¸¸å®‰è£…å’Œä½¿ç”¨
2. **æ ‡å‡†åˆè§„æ€§** - æ˜¯å¦éµå¾ªæœ¬æŒ‡å—
3. **å®‰å…¨æ€§** - ä¸‹è½½é“¾æ¥å’Œæ ¡éªŒå’Œæ­£ç¡®æ€§
4. **å¯ç»´æŠ¤æ€§** - ä»£ç æ¸…æ™°æ˜“æ‡‚

## ğŸ“„ è®¸å¯è¯

æœ¬æ–‡æ¡£å’Œç›¸å…³æ ‡å‡†éµå¾ªé¡¹ç›®çš„ [MIT è®¸å¯è¯](../LICENSE)ã€‚æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘è¿™äº›æ ‡å‡†ï¼Œä½†è¯·ä¿ç•™ç‰ˆæƒå£°æ˜ã€‚

---

*æœ€åæ›´æ–°: $(date '+%Y-%m-%d')*  
*ç»´æŠ¤è€…: gandli*
